import { Z_INDEX } from '@/utils/constant'
import {
  getSyntheticTouchPoint,
  refineCanvasRatio,
  clearCanvas,
  isPointInsideRect,
} from './canvas.utils'

interface ImageObject {
  sx: number
  sy: number
  width: number
  height: number
  dataUrl: string
  ref?: HTMLImageElement
}

interface DragTarget {
  /** drag start x */
  sx: number
  /** drag start y */
  sy: number
  /** related ImageObject entity */
  image: ImageObject
}

const sample: ImageObject = {
  sx: 250,
  sy: 250,
  width: 225,
  height: 225,
  dataUrl:
    'data:image/jpeg;base64,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',
}

const sample2: ImageObject = {
  sx: 500,
  sy: 500,
  width: 225,
  height: 225,
  dataUrl:
    'data:image/jpeg;base64,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',
}

const template = document.createElement('template')
template.innerHTML = `
  <style>
    :host #image-layer {
      width: 100%;
      height: 100%;
      z-index: ${Z_INDEX.CANVAS_LAYER.IMAGE};
      position: absolute;
    }
  </style>
  <canvas id="image-layer"></canvas>
`

export default class VCanvasImageLayer extends HTMLElement {
  private $root!: ShadowRoot
  private $canvas!: HTMLCanvasElement
  private context!: CanvasRenderingContext2D
  private images: ImageObject[] = []
  private draggedImage: DragTarget | null = null
  private draggedIndex = -1

  static tag = 'v-canvas-image-layer'

  constructor() {
    const initShadowRoot = () => {
      this.$root = this.attachShadow({ mode: 'open' })
      this.$root.appendChild(template.content.cloneNode(true))
    }

    const initCanvas = () => {
      this.$canvas = this.$root.getElementById('image-layer') as HTMLCanvasElement
      const ctx = this.$canvas.getContext('2d')
      if (!ctx) {
        throw new Error('ðŸš¨ canvas load fail')
      }
      this.context = ctx
    }

    super()
    initShadowRoot()
    initCanvas()
  }

  listenExternalEvent(ev: Event) {
    switch (ev.type) {
      case 'mousedown':
      case 'touchstart':
        this.touch(ev as MouseEvent)
        break
      case 'mousemove':
      case 'touchmove':
        this.draggedImage && this.drag(ev as MouseEvent | TouchEvent)
        break
      case 'mouseup':
      case 'touchend':
        this.draggedImage = null
        break
      default:
        break
    }
  }

  connectedCallback() {
    const drawSampleImage = () => {
      const image1 = new Image()
      image1.src = sample.dataUrl
      sample.ref = image1

      image1.onload = () => {
        this.images.push(sample)
        this.paintImages()
      }

      const image2 = new Image()
      image2.src = sample2.dataUrl
      sample2.ref = image2

      image2.onload = () => {
        this.images.push(sample2)
        this.paintImages()
      }
    }

    refineCanvasRatio(this.$canvas)
    drawSampleImage()
  }

  touch(ev: MouseEvent | TouchEvent) {
    const { x, y } = getSyntheticTouchPoint(this.$canvas, ev)

    const setDraggableImageObjectAtTouchPoint = () => {
      const index = this.images.findIndex((image) =>
        isPointInsideRect({
          pivot: {
            sx: image.sx,
            sy: image.sy,
            width: image.width,
            height: image.height,
          },
          pos: { x, y },
        })
      )

      if (index > -1) {
        this.draggedIndex = index
        this.draggedImage = { sx: x, sy: y, image: this.images[index] }
      } else {
        this.draggedIndex = -1
        this.draggedImage = null
      }
    }

    setDraggableImageObjectAtTouchPoint()
  }

  drag(ev: MouseEvent | TouchEvent) {
    const paint = () => {
      if (!this.draggedImage) {
        return
      }

      const { x, y } = getSyntheticTouchPoint(this.$canvas, ev)
      const dx = x - this.draggedImage.sx
      const dy = y - this.draggedImage.sy

      const draggedImageEntity = this.images[this.draggedIndex]
      draggedImageEntity.sx += dx
      draggedImageEntity.sy += dy

      this.draggedImage.sx = x
      this.draggedImage.sy = y

      this.paintImages()
    }

    paint()
  }

  paintImages() {
    clearCanvas(this.$canvas)

    this.images.forEach(({ ref, sx, sy, width, height }) => {
      if (ref) {
        this.context.drawImage(ref, sx, sy, width, height)
      }
    })
  }
}
